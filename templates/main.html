{% extends "layout.html" %}
{% block post_body %}
<script type="text/javascript">

    var box_hei = 80,
            box_wid = 800;

    var render = function () {
        d3.json("http://localhost:5000/history", function (jdata) {
            var selec_box = d3.select("div.content").selectAll("div.box");

//            d3.select("div.page").selectAll("div.box")
            selec_box
                    .data(jdata)
                    .enter()
                    .append("div").attr("class", "box")
                    .attr("id", get_hostname)
                    .style("width", box_wid + "px").style("height", box_hei + "px");

//            d3.select("div.page").selectAll("div.box")
            selec_box
                    .data(jdata)
                    .exit()
                    .remove();

            for (var res in jdata) {
                selec_box = d3.select("div.content div.box[id='" + jdata[res]["host"] + "']")
                        .selectAll("div.v-bar");

//                d3.select("div.page div.box[id='" + jdata[res]["host"] + "']").selectAll("div.v-bar")
                selec_box
                        .data(jdata[res]["history"])
                        .enter()
                        .append("div").attr("class", "v-bar")
                        .append("span");

//                d3.select("div.page div.box[id='" + jdata[res]["host"] + "']").selectAll("div.v-bar")
                selec_box
                        .data(jdata[res]["history"])
                        .exit()
                        .remove();

//                d3.select("div.page div.box[id='" + jdata[res]["host"] + "']").selectAll("div.v-bar")
                selec_box
                        .data(jdata[res]["history"])
                        .attr("class", "v-bar").style("height", get_hei).style("left", function(d, i) {
                            return (2 + i * 27) + "px";
                        });
            }
        });
    };

    var get_hostname = function (d) {
        return d["host"];
    };

    var get_hei = function (d) {
        return (d["resp_t"] * 100) + "px";
    };

    render();
    setInterval(render, 2000);

</script>
{% endblock %}